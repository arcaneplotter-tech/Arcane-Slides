<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Arcane Slides Â· floating menu</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&family=Inter:wght@400;500;600;700;800;900&family=Patrick+Hand&family=Permanent+Marker&family=Playfair+Display:wght@400;700&family=Space+Mono:wght@400;700&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- Babel Standalone for in-browser JSX/TS compilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
      /* Custom utilities */
      .font-hand { font-family: 'Patrick Hand', cursive; }
      .font-marker { font-family: 'Permanent+Marker', cursive; }
      .font-comic { font-family: 'Comic Neue', cursive; }
      .font-sans-pro { font-family: 'Inter', sans-serif; }
      .font-serif-elegant { font-family: 'Playfair Display', serif; }
      .font-mono-cyber { font-family: 'Space Mono', monospace; }
      .font-dm { font-family: 'DM Sans', sans-serif; }
      
      .paper-lines {
        background-color: #fdfbf7;
        background-image: repeating-linear-gradient(transparent, transparent 31px, #94a3b8 31px, #94a3b8 32px);
      }
      
      .grid-paper {
        background-color: #fdf6e3;
        background-image: 
          linear-gradient(#d1d5db 1px, transparent 1px),
          linear-gradient(90deg, #d1d5db 1px, transparent 1px);
        background-size: 40px 40px;
      }

      .washi-tape {
        mask-image: url("data:image/svg+xml,%3Csvg width='200' height='40' viewBox='0 0 200 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 10 Q 5 0, 10 5 T 20 5 T 30 5 T 40 5 T 50 5 T 60 5 T 70 5 T 80 5 T 90 5 T 100 5 T 110 5 T 120 5 T 130 5 T 140 5 T 150 5 T 160 5 T 170 5 T 180 5 T 190 5 T 200 10 L 200 30 Q 195 40, 190 35 T 180 35 T 170 35 T 160 35 T 150 35 T 140 35 T 130 35 T 120 35 T 110 35 T 100 35 T 90 35 T 80 35 T 70 35 T 60 35 T 50 35 T 40 35 T 30 35 T 20 35 T 10 35 T 0 30 Z' fill='black'/%3E%3C/svg%3E");
        mask-size: 100% 100%;
        mask-repeat: no-repeat;
      }
      
      /* Scrollbar */
      .custom-scrollbar::-webkit-scrollbar { width: 8px; height: 8px; }
      .custom-scrollbar::-webkit-scrollbar-track { background: #1e293b; }
      .custom-scrollbar::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
      .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #64748b; }
      
      /* Safe area for mobile */
      .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
      
      /* floating menu animation */
      @keyframes float-pop {
        0% { opacity: 0; transform: scale(0.9) translateY(10px); }
        100% { opacity: 1; transform: scale(1) translateY(0); }
      }
      .animate-float-pop {
        animation: float-pop 0.2s ease-out forwards;
      }

      /* cool animations */
      @keyframes slide-in-left {
        from { opacity: 0; transform: translateX(-20px); }
        to { opacity: 1; transform: translateX(0); }
      }
      .animate-slide-in-left {
        animation: slide-in-left 0.3s ease-out forwards;
      }

      @keyframes fade-in {
        from { opacity: 0; }
        to { opacity: 1; }
      }
      .animate-fade-in {
        animation: fade-in 0.4s ease-in forwards;
      }

      @keyframes pulse-glow {
        0%, 100% { box-shadow: 0 0 0 0 rgba(59,130,246,0.5); }
        50% { box-shadow: 0 0 20px 5px rgba(59,130,246,0.8); }
      }
      .animate-pulse-glow {
        animation: pulse-glow 2s infinite;
      }

      .hover-lift {
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }
      .hover-lift:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px -5px rgba(0,0,0,0.3);
      }
      
      /* Scrollbar */
      .custom-scrollbar::-webkit-scrollbar { width: 8px; height: 8px; }
      .custom-scrollbar::-webkit-scrollbar-track { background: #1e293b; }
      .custom-scrollbar::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
      .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #64748b; }
      
      /* Safe area for mobile */
      .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
      
    </style>

    <!-- Import Map for modules -->
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
    "lucide-react": "https://esm.sh/lucide-react@0.263.1",
    "pptxgenjs": "https://esm.sh/pptxgenjs@3.12.0",
    "html-to-image": "https://esm.sh/html-to-image@1.11.11",
    "react-dom/": "https://esm.sh/react-dom@^19.2.4/",
    "react/": "https://esm.sh/react@^19.2.4/"
  }
}
</script>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel" data-type="module" data-presets="typescript,react">
      import React, { useState, useEffect, useRef, useLayoutEffect } from 'react';
      import { createRoot } from 'react-dom/client';
      import { 
        Copy, ChevronLeft, ChevronRight, Layout, Type, Palette, 
        Play, FileDown, Wand2, Edit3, MonitorPlay, 
        BookOpen, Quote, LayoutList, Grip, GitCommit, AlignCenter, Image as ImageIcon,
        Type as TypeIcon, Scale, AlignLeft, AlignRight, Columns, Zap, Waves, TreePine,
        Menu, X, ExternalLink  // added icons for floating menu
      } from 'lucide-react';
      import pptxgen from 'pptxgenjs';
      import { toPng } from 'html-to-image';

      // ==========================================
      // CONSTANTS & CONFIG
      // ==========================================

      const THEMES = {
        notebook: {
          name: 'notebook',
          bgClass: 'paper-lines',
          fontTitle: 'font-marker',
          fontBody: 'font-hand',
          colors: { primary: '#1e293b', secondary: '#fca5a5', accent: '#fde047', text: '#334155' },
        },
        grid: {
          name: 'grid',
          bgClass: 'grid-paper',
          fontTitle: 'font-comic',
          fontBody: 'font-comic',
          colors: { primary: '#5b21b6', secondary: '#8b5cf6', accent: '#c4b5fd', text: '#4c1d95' },
        },
        professional: {
          name: 'professional',
          bgClass: 'bg-gradient-to-br from-slate-50 to-slate-200',
          fontTitle: 'font-sans-pro font-extrabold',
          fontBody: 'font-sans-pro',
          colors: { primary: '#0f172a', secondary: '#3b82f6', accent: '#dbeafe', text: '#334155' },
        },
        cyber: {
          name: 'cyber',
          bgClass: 'bg-[#0f172a]',
          fontTitle: 'font-mono-cyber',
          fontBody: 'font-mono-cyber',
          colors: { primary: '#22d3ee', secondary: '#a855f7', accent: '#1e293b', text: '#e2e8f0' },
        },
        pop: {
          name: 'pop',
          bgClass: 'bg-[#fffbeb]',
          fontTitle: 'font-marker',
          fontBody: 'font-sans-pro font-bold',
          colors: { primary: '#000000', secondary: '#ef4444', accent: '#fbbf24', text: '#111827' },
        },
        elegant: {
          name: 'elegant',
          bgClass: 'bg-[#fafaf9]',
          fontTitle: 'font-serif-elegant',
          fontBody: 'font-sans-pro',
          colors: { primary: '#1c1917', secondary: '#a8a29e', accent: '#e7e5e4', text: '#44403c' },
        },
        swiss: {
          name: 'swiss',
          bgClass: 'bg-white',
          fontTitle: 'font-sans-pro font-black tracking-tight',
          fontBody: 'font-sans-pro font-medium',
          colors: { primary: '#000000', secondary: '#e11d48', accent: '#f3f4f6', text: '#000000' },
        },
        neo: {
          name: 'neo',
          bgClass: 'bg-slate-50',
          fontTitle: 'font-dm font-bold',
          fontBody: 'font-dm',
          colors: { primary: '#1e293b', secondary: '#6366f1', accent: '#c084fc', text: '#334155' },
        },
        onyx: {
          name: 'onyx',
          bgClass: 'bg-zinc-950',
          fontTitle: 'font-sans-pro font-bold tracking-wide',
          fontBody: 'font-sans-pro',
          colors: { primary: '#ffffff', secondary: '#34d399', accent: '#27272a', text: '#d4d4d8' },
        },
        sunset: {
          name: 'sunset',
          bgClass: 'bg-gradient-to-br from-orange-400 via-pink-500 to-purple-600',
          fontTitle: 'font-dm font-bold tracking-tight',
          fontBody: 'font-dm',
          colors: { primary: '#ffffff', secondary: '#fbbf24', accent: '#ffffff', text: '#fdf2f8' },
        },
        ocean: {
          name: 'ocean',
          bgClass: 'bg-gradient-to-tl from-cyan-500 to-blue-700',
          fontTitle: 'font-sans-pro font-bold',
          fontBody: 'font-sans-pro',
          colors: { primary: '#ffffff', secondary: '#67e8f9', accent: '#cffafe', text: '#ecfeff' },
        },
        forest: {
          name: 'forest',
          bgClass: 'bg-[#064e3b]',
          fontTitle: 'font-serif-elegant',
          fontBody: 'font-sans-pro',
          colors: { primary: '#ecfdf5', secondary: '#34d399', accent: '#d1fae5', text: '#d1fae5' },
        },
        bauhaus: {
          name: 'bauhaus',
          bgClass: 'bg-[#f4f4f0]',
          fontTitle: 'font-sans-pro font-black',
          fontBody: 'font-mono-cyber',
          colors: { primary: '#111827', secondary: '#dc2626', accent: '#2563eb', text: '#374151' },
        },
        electric: {
          name: 'electric',
          bgClass: 'bg-[#4c1d95]',
          fontTitle: 'font-sans-pro font-extrabold italic',
          fontBody: 'font-sans-pro font-bold',
          colors: { primary: '#facc15', secondary: '#e879f9', accent: '#22d3ee', text: '#ffffff' },
        },
        candy: {
          name: 'candy',
          bgClass: 'bg-[#fce7f3]',
          fontTitle: 'font-comic',
          fontBody: 'font-sans-pro font-medium',
          colors: { primary: '#db2777', secondary: '#60a5fa', accent: '#fcd34d', text: '#831843' },
        },
      };

      const DEFAULT_CSV = `type,title,content,footer
title,Q3 Business Review,Financial Performance & Key Milestones|Prepared by: Strategy Team,Confidential
list,Executive Summary,Revenue grew by 15% QoQ exceeding targets|User acquisition cost dropped by 12% due to organic growth|Launched 3 new features in the mobile app|Strategic partnership with TechCorp finalized|Employee retention rate remains at 98%|Customer Net Promoter Score (NPS) increased to 72,Oct 2023
image-right,Our New Office,Located in the heart of the Tech District|Open space concept designed for collaboration|Dedicated zones for deep work and meetings|Capacity for 150+ employees|Opening Ceremony: Dec 15th,Facilities
grid,Key Metrics,Revenue: $4.2M - Exceeded target by 12%|Churn Rate: 1.8% - Lowest in 2 years|MAU: 850k - Up 20% from Q2|NPS: 72 - Industry standard is 50|Burn Rate: $120k - Reduced by optimization,Q3 Data
split,Growth Strategy,Marketing Channels:|Focused on SEO and Content Marketing.|Reduced paid ad spend by 20% while maintaining lead volume.|Launched referral program for enterprise clients.|Product Development:|Released 'Dark Mode' requested by 40% of users.|Beta testing AI assistant feature.|Backend infrastructure migration 80% complete.,2024 Outlook
timeline,Product Roadmap,Q1: Research & Design - User interviews completed|Q2: MVP Development - Core features built|Q3: Beta Launch - 500 test users onboarded|Q4: Global Rollout - Full marketing push,2023-2024
quote,Vision,"Innovation distinguishes between a leader and a follower.",Steve Jobs
`;

      const CHATGPT_PROMPT = `I need you to generate a CSV file for a presentation. 
The CSV must have the following header: type,title,content,footer
The 'content' column should use the pipe character '|' to separate multiple bullet points or sections.
Allowed 'type' values are:
- title (Use for the cover slide)
- list (Use for bullet points, supports "Key: Value" format for bolding)
- split (Use for two-column text, supports pipe '|' for paragraphs)
- quote (Use for a big statement or quote)
- timeline (Use for sequential steps, supports "Phase: Description" format)
- grid (Use for metrics or features, supports "Metric: Value" format)
- image-right (Use for text on left, photo placeholder on right)
- image-left (Use for photo placeholder on left, text on right)
- comparison (Use for side-by-side comparison, use '---' separator)
- centered (Use for centered large text)

Please create a dense, information-rich CSV for a presentation about [YOUR TOPIC HERE].`;

      // ==========================================
      // UTILS
      // ==========================================

      // CSV Parser
      const parseCSV = (csvText) => {
        const lines = csvText.trim().split('\n');
        const slides = [];
        const startIndex = lines[0].toLowerCase().startsWith('type,') ? 1 : 0;

        for (let i = startIndex; i < lines.length; i++) {
          const line = lines[i].trim();
          if (!line) continue;
          
          // Split by comma, respecting quotes
          const parts = line.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(s => s.trim().replace(/^"(.*)"$/, '$1'));

          if (parts.length >= 2) {
            const type = parts[0].toLowerCase();
            const title = parts[1] || '';
            const rawContent = parts[2] || '';
            const footer = parts[3] || '';
            const accent = parts[4] || '';
            const content = rawContent.split('|').map(s => s.trim());

            slides.push({
              id: `slide-${i}`,
              type,
              title,
              content,
              footer,
              accent
            });
          }
        }
        return slides;
      };

      // PPTX Generator
      const generatePPTX = async (images, themeName) => {
        const pptx = new pptxgen();
        pptx.layout = 'LAYOUT_16x9';
        images.forEach((imgData) => {
          const slide = pptx.addSlide();
          slide.background = { data: imgData };
        });
        return pptx.writeFile({ fileName: `ArcaneSlides-${themeName}.pptx` });
      };

      // ==========================================
      // COMPONENTS
      // ==========================================

      // Helper: Font Sizing
      const fs = (remSize, scale = 1) => {
        return { 
          fontSize: `${remSize * scale}rem`,
          lineHeight: 1.3 
        };
      };

      // Helper: Washi Tape
      const WashiTape = ({ color, className }) => (
        <div 
          className={`absolute h-8 w-32 washi-tape opacity-90 z-10 ${className}`}
          style={{ backgroundColor: color }}
        />
      );

      // Helper: Background Decorations
      const BackgroundDecorations = ({ theme }) => {
        switch (theme.name) {
          case 'sunset':
            return (
              <>
                 <div className="absolute top-[-20%] right-[-10%] w-[600px] h-[600px] rounded-full bg-white/10 blur-3xl pointer-events-none"></div>
                 <div className="absolute bottom-[-20%] left-[-10%] w-[500px] h-[500px] rounded-full bg-yellow-400/20 blur-3xl pointer-events-none"></div>
              </>
            );
          case 'ocean':
             return (
               <>
                 <div className="absolute bottom-0 left-0 right-0 h-32 opacity-20 pointer-events-none">
                     <svg viewBox="0 0 1440 320" preserveAspectRatio="none" className="w-full h-full">
                         <path fill="#fff" d="M0,224L48,213.3C96,203,192,181,288,181.3C384,181,480,203,576,224C672,245,768,267,864,261.3C960,256,1056,224,1152,197.3C1248,171,1344,149,1392,138.7L1440,128L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path>
                     </svg>
                 </div>
               </>
             );
          case 'forest':
             return (
                 <div className="absolute inset-0 opacity-10 pointer-events-none" style={{ backgroundImage: 'radial-gradient(circle, #fff 1px, transparent 1px)', backgroundSize: '30px 30px' }}></div>
             );
          case 'bauhaus':
             return (
               <>
                 <div className="absolute top-10 left-10 w-24 h-24 bg-red-600 rounded-full opacity-80 mix-blend-multiply"></div>
                 <div className="absolute top-20 left-24 w-24 h-24 bg-blue-600 opacity-80 mix-blend-multiply"></div>
                 <div className="absolute bottom-10 right-10 w-0 h-0 border-l-[50px] border-l-transparent border-b-[80px] border-b-yellow-500 border-r-[50px] border-r-transparent"></div>
               </>
             );
          case 'electric':
             return (
               <>
                 <div className="absolute top-0 right-0 w-full h-full opacity-10 bg-[repeating-linear-gradient(45deg,transparent,transparent_10px,#fff_10px,#fff_12px)]"></div>
                 <div className="absolute bottom-10 left-10 text-yellow-400 opacity-20 transform -rotate-12">
                     <Zap size={200} fill="currentColor" />
                 </div>
               </>
             );
          case 'candy':
             return (
               <>
                 <div className="absolute top-[-50px] right-[-50px] w-48 h-48 bg-blue-300 rounded-full opacity-50 blur-xl"></div>
                 <div className="absolute bottom-[-50px] left-[-50px] w-64 h-64 bg-yellow-200 rounded-full opacity-50 blur-xl"></div>
                 <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full h-full border-[20px] border-white/40 rounded-3xl pointer-events-none"></div>
               </>
             );
           default: return null;
        }
      };

      const getContainerStyle = (theme) => {
        const base = "h-full";
        switch (theme.name) {
          case 'notebook': return `${base} bg-white p-8 shadow-md rotate-1 border border-slate-200`;
          case 'grid': return `${base} bg-white border-2 border-black block-shadow`;
          case 'professional': return `${base} bg-white/60 rounded-xl border border-slate-200/50 shadow-sm`;
          case 'cyber': return `${base} border border-gray-700 p-8 bg-[#1e293b]/50`;
          case 'pop': return `${base} bg-white border-4 border-black shadow-[8px_8px_0px_0px_rgba(0,0,0,1)]`;
          case 'elegant': return `${base} bg-white border border-stone-200`;
          case 'swiss': return `${base} border-4 border-black bg-white`;
          case 'neo': return `${base} bg-white/60 rounded-3xl border border-white/50 shadow-xl backdrop-blur-md`;
          case 'onyx': return `${base} bg-zinc-900/50 border border-zinc-800 rounded-xl`;
          case 'sunset': return `${base} bg-white/10 border border-white/20 rounded-xl backdrop-blur-sm`;
          case 'ocean': return `${base} bg-white/10 border border-white/20 rounded-xl backdrop-blur-sm`;
          case 'forest': return `${base} border border-emerald-700/30 bg-emerald-900/50 rounded-lg`;
          case 'bauhaus': return `${base} bg-[#fdfdfb] border-2 border-black`;
          case 'electric': return `${base} border-4 border-yellow-400 bg-black/20 skew-x-[-2deg]`;
          case 'candy': return `${base} bg-white/60 border-4 border-white rounded-[2rem] shadow-sm`;
          default: return base;
        }
      }

      // --- Slide Templates ---
      
      const TitleSlide = ({ data, theme, fontScale = 1 }) => {
        return (
          <div className={`w-full h-full flex flex-col items-center justify-center relative p-12 ${theme.bgClass} overflow-hidden`}>
            <BackgroundDecorations theme={theme} />

            {theme.name === 'notebook' && (
              <>
                <WashiTape color={theme.colors.secondary} className="-top-4 left-1/4 -rotate-2" />
                <WashiTape color={theme.colors.accent} className="bottom-12 right-12 rotate-3" />
                <div className="absolute top-0 right-0 p-8 opacity-10">
                  <BookOpen size={180} />
                </div>
              </>
            )}
            
            {theme.name === 'grid' && (
               <div className="absolute inset-6 border-2 border-dashed opacity-40 rounded-3xl" style={{ borderColor: theme.colors.primary }} />
            )}

            {theme.name === 'professional' && (
               <>
                  <div className="absolute top-0 left-0 w-1/4 h-full opacity-10" style={{ backgroundColor: theme.colors.secondary }} />
                  <div className="absolute bottom-0 right-0 w-64 h-64 rounded-full blur-3xl opacity-20" style={{ backgroundColor: theme.colors.accent }} />
               </>
            )}

            {theme.name === 'cyber' && (
               <div className="absolute inset-0 opacity-20 pointer-events-none" style={{ 
                   backgroundImage: `linear-gradient(${theme.colors.primary} 1px, transparent 1px), linear-gradient(90deg, ${theme.colors.primary} 1px, transparent 1px)`,
                   backgroundSize: '40px 40px'
               }}></div>
            )}

            {theme.name === 'pop' && (
              <>
                <div className="absolute top-10 left-10 w-24 h-24 rounded-full opacity-80" style={{ backgroundColor: theme.colors.secondary }} />
                <div className="absolute bottom-10 right-10 w-0 h-0 border-l-[60px] border-l-transparent border-t-[90px] border-r-[60px] border-r-transparent rotate-12 opacity-80" style={{ borderTopColor: theme.colors.accent }} />
                <div className="absolute top-1/2 left-8 w-12 h-12 rotate-45" style={{ backgroundColor: theme.colors.primary }} />
              </>
            )}

            {theme.name === 'elegant' && (
               <div className="absolute inset-8 border pointer-events-none" style={{ borderColor: theme.colors.secondary, borderWidth: '1px' }}>
                  <div className="absolute inset-1 border" style={{ borderColor: theme.colors.secondary, borderWidth: '1px' }}></div>
               </div>
            )}

            {theme.name === 'swiss' && (
                <>
                    <div className="absolute top-0 left-0 w-8 h-full" style={{ backgroundColor: theme.colors.secondary }}></div>
                    <div className="absolute top-12 left-0 w-48 h-12 flex items-center justify-end pr-4 text-white font-bold uppercase tracking-tighter" style={{ backgroundColor: 'black' }}>
                         Thinking
                    </div>
                </>
            )}

            {theme.name === 'neo' && (
                <>
                    <div className="absolute top-0 left-0 w-full h-full bg-gradient-to-br from-slate-100 to-slate-200"></div>
                    <div className="absolute top-[-20%] right-[-10%] w-[600px] h-[600px] rounded-full blur-[80px] opacity-40" style={{ backgroundColor: theme.colors.secondary }}></div>
                    <div className="absolute bottom-[-20%] left-[-10%] w-[600px] h-[600px] rounded-full blur-[80px] opacity-40" style={{ backgroundColor: theme.colors.accent }}></div>
                </>
            )}
            
            {theme.name === 'onyx' && (
                 <div className="absolute inset-0 bg-[radial-gradient(circle_at_top_right,_var(--tw-gradient-stops))] from-zinc-800/50 via-zinc-950 to-zinc-950"></div>
            )}

            <div className="z-10 text-center max-w-4xl relative">
                <span 
                  className={`inline-block py-1 px-3 rounded-full font-bold tracking-widest uppercase mb-6 opacity-80 ${theme.fontBody}`} 
                  style={{ 
                      backgroundColor: theme.name === 'swiss' ? 'black' : theme.colors.accent, 
                      color: theme.name === 'swiss' ? 'white' : theme.colors.primary, 
                      ...fs(0.875, fontScale) 
                  }}
                >
                  Presentation
                </span>
                
                <h1 
                  className={`font-bold mb-8 leading-tight ${theme.fontTitle}`} 
                  style={{ color: theme.colors.primary, ...fs(4.5, fontScale), textShadow: theme.name === 'cyber' || theme.name === 'electric' ? `0 0 20px ${theme.colors.secondary}` : 'none' }}
                >
                  {data.title}
                </h1>
                
                <div 
                  className={`opacity-90 ${theme.fontBody}`} 
                  style={{ color: theme.colors.text }}
                >
                  {data.content.map((line, i) => (
                    <p key={i} className={i === 0 ? 'font-semibold mb-2' : 'mb-1'} style={fs(i === 0 ? 1.5 : 1.25, fontScale)}>
                      {line}
                    </p>
                  ))}
                </div>
            </div>

            {data.footer && (
               <div 
                  className={`absolute bottom-8 w-full text-center border-t pt-4 max-w-2xl mx-auto opacity-60 font-medium tracking-wide ${theme.fontBody}`} 
                  style={{ borderColor: theme.colors.text, color: theme.colors.text, ...fs(0.875, fontScale) }}
               >
                  {data.footer}
               </div>
            )}
          </div>
        );
      };

      const ListSlide = ({ data, theme, fontScale = 1 }) => {
        const isDense = data.content.length > 5;
        const gridClass = isDense ? 'grid-cols-2' : 'grid-cols-1';

        return (
          <div className={`w-full h-full p-12 relative flex flex-col ${theme.bgClass} overflow-hidden`}>
             <BackgroundDecorations theme={theme} />
             {theme.name === 'notebook' && (
                <div className="absolute top-0 left-1/2 -translate-x-1/2 w-48 h-8 bg-[#fca5a5] washi-tape -rotate-1 shadow-sm opacity-90 z-20 top-tape"></div>
             )}

             {theme.name === 'neo' && (
                <>
                    <div className="absolute top-0 left-0 w-full h-full bg-gradient-to-br from-slate-100 to-slate-200 -z-10"></div>
                    <div className="absolute top-[-20%] left-[-10%] w-[500px] h-[500px] rounded-full blur-[80px] opacity-30 pointer-events-none" style={{ backgroundColor: theme.colors.accent }}></div>
                </>
             )}
            
            <div className="flex items-center gap-4 mb-8 z-10 border-b pb-4" style={{ borderColor: `${theme.colors.primary}33` }}>
              <div className="p-2 rounded-lg" style={{ backgroundColor: theme.name === 'swiss' ? 'black' : theme.colors.accent }}>
                  <LayoutList size={24} style={{ color: theme.name === 'swiss' ? 'white' : theme.colors.primary }} />
              </div>
              <h2 className={`font-bold ${theme.fontTitle}`} style={{ color: theme.colors.primary, ...fs(2.25, fontScale) }}>
                {data.title}
              </h2>
            </div>

            <div className="flex-1 z-10 min-h-0">
              <div className={getContainerStyle(theme)}>
                 <ul className={`grid ${gridClass} gap-x-12 gap-y-4 h-full content-start ${theme.fontBody}`}>
                   {data.content.map((item, idx) => (
                     <li key={idx} className="flex items-start gap-3 group">
                       <span className={`mt-2 w-2 h-2 flex-shrink-0 transition-all group-hover:scale-125
                          ${theme.name === 'swiss' || theme.name === 'bauhaus' || theme.name === 'electric' ? '' : 'rounded-full'}
                       `} style={{ backgroundColor: theme.colors.secondary }} />
                       <span className="leading-snug" style={{ color: theme.colors.text, ...fs(1.25, fontScale) }}>
                          {item.includes(':') ? (
                              <>
                                  <span className="font-bold mr-1" style={{ color: theme.name === 'cyber' || theme.name === 'swiss' || theme.name === 'electric' ? theme.colors.primary : 'inherit' }}>{item.split(':')[0]}:</span>
                                  <span className="opacity-90">{item.split(':').slice(1).join(':')}</span>
                              </>
                          ) : item}
                       </span>
                     </li>
                   ))}
                 </ul>
              </div>
            </div>
            
            {data.footer && <div className="absolute bottom-4 right-8 opacity-40" style={{ color: theme.colors.text, ...fs(0.75, fontScale) }}>{data.footer}</div>}
          </div>
        );
      };

      const SplitSlide = ({ data, theme, fontScale = 1 }) => {
          const leftContent = data.content[0] || "";
          const rightContent = data.content.slice(1).join('\n') || "";

          return (
              <div className={`w-full h-full p-12 flex flex-col ${theme.bgClass} relative overflow-hidden`}>
                  <BackgroundDecorations theme={theme} />
                  {theme.name === 'neo' && <div className="absolute inset-0 bg-gradient-to-br from-slate-100 to-slate-200 -z-10" />}

                  <div className="flex items-center gap-4 mb-8 border-b pb-4 z-10" style={{ borderColor: `${theme.colors.primary}33` }}>
                      <div className="p-2 rounded-lg" style={{ backgroundColor: theme.name === 'swiss' ? 'black' : theme.colors.accent }}>
                          <AlignCenter size={24} style={{ color: theme.name === 'swiss' ? 'white' : theme.colors.primary }} />
                      </div>
                      <h2 className={`font-bold ${theme.fontTitle}`} style={{ color: theme.colors.primary, ...fs(2.25, fontScale) }}>
                          {data.title}
                      </h2>
                  </div>

                  <div className="flex-1 flex gap-8 z-10 min-h-0">
                      <div className={`flex-1 p-8 overflow-hidden flex flex-col justify-center ${getContainerStyle(theme)}`}>
                          <div className={`whitespace-pre-wrap leading-relaxed ${theme.fontBody}`} style={{ color: theme.colors.text, ...fs(1.125, fontScale) }}>
                              {leftContent.split('|').map((line, i) => (
                                   <p key={i} className="mb-4">{line}</p>
                              ))}
                          </div>
                      </div>
                      
                      <div className={`flex-1 p-8 overflow-hidden flex flex-col justify-center ${getContainerStyle(theme)}
                          ${theme.name === 'swiss' ? '!bg-black !text-white' : ''}
                      `}>
                           <div className={`whitespace-pre-wrap leading-relaxed ${theme.fontBody}`} style={{ color: theme.name === 'swiss' ? 'white' : theme.colors.text, ...fs(1.125, fontScale) }}>
                              {rightContent.split('|').map((line, i) => (
                                   <p key={i} className="mb-4">{line}</p>
                              ))}
                          </div>
                      </div>
                  </div>
                  
                   {data.footer && <div className="absolute bottom-4 right-8 opacity-40" style={{ color: theme.colors.text, ...fs(0.75, fontScale) }}>{data.footer}</div>}
              </div>
          );
      };

      const ComparisonSlide = ({ data, theme, fontScale = 1 }) => {
          let leftItems = [];
          let rightItems = [];
          const separatorIndex = data.content.findIndex(item => item.includes('---'));
          
          if (separatorIndex !== -1) {
              leftItems = data.content.slice(0, separatorIndex);
              rightItems = data.content.slice(separatorIndex + 1);
          } else {
              const mid = Math.ceil(data.content.length / 2);
              leftItems = data.content.slice(0, mid);
              rightItems = data.content.slice(mid);
          }

          const renderCard = (items, isRight = false) => (
             <div className={`flex-1 p-6 md:p-8 flex flex-col h-full ${getContainerStyle(theme)}
                  ${theme.name === 'swiss' && isRight ? '!bg-black !text-white !border-black' : ''}
             `}>
                  <h3 className={`font-bold mb-4 pb-2 border-b ${theme.fontTitle}`} style={{ borderColor: theme.colors.secondary, color: (theme.name === 'swiss' && isRight) ? 'white' : theme.colors.primary, ...fs(1.5, fontScale) }}>
                      {items[0] || 'Header'}
                  </h3>
                  <ul className={`flex-1 space-y-3 ${theme.fontBody}`}>
                      {items.slice(1).map((item, i) => (
                          <li key={i} className="flex items-start gap-3">
                              <span className="mt-1.5 w-1.5 h-1.5 rounded-full flex-shrink-0" style={{ backgroundColor: theme.colors.secondary }} />
                              <span style={{ color: (theme.name === 'swiss' && isRight) ? '#d4d4d4' : theme.colors.text, ...fs(1.125, fontScale) }}>{item}</span>
                          </li>
                      ))}
                  </ul>
             </div>
          );

          return (
              <div className={`w-full h-full p-12 flex flex-col ${theme.bgClass} relative overflow-hidden`}>
                  <BackgroundDecorations theme={theme} />
                  {theme.name === 'neo' && <div className="absolute inset-0 bg-gradient-to-br from-slate-100 to-slate-200 -z-10" />}

                  <div className="flex items-center gap-4 mb-8 border-b pb-4 z-10" style={{ borderColor: `${theme.colors.primary}33` }}>
                      <div className="p-2 rounded-lg" style={{ backgroundColor: theme.name === 'swiss' ? 'black' : theme.colors.accent }}>
                          <Scale size={24} style={{ color: theme.name === 'swiss' ? 'white' : theme.colors.primary }} />
                      </div>
                      <h2 className={`font-bold ${theme.fontTitle}`} style={{ color: theme.colors.primary, ...fs(2.25, fontScale) }}>
                          {data.title}
                      </h2>
                  </div>

                  <div className="flex-1 flex gap-8 z-10 min-h-0 items-stretch">
                      {renderCard(leftItems, false)}
                      
                      <div className="flex flex-col items-center justify-center">
                          <div className="h-full w-px bg-slate-300/50"></div>
                          <div className={`p-2 rounded-full font-bold text-xs uppercase my-4 ${theme.fontBody}`} style={{ backgroundColor: theme.colors.accent, color: theme.colors.primary }}>VS</div>
                          <div className="h-full w-px bg-slate-300/50"></div>
                      </div>

                      {renderCard(rightItems, true)}
                  </div>
                   {data.footer && <div className="absolute bottom-4 right-8 opacity-40" style={{ color: theme.colors.text, ...fs(0.75, fontScale) }}>{data.footer}</div>}
              </div>
          );
      };

      const CenteredSlide = ({ data, theme, fontScale = 1 }) => {
          return (
              <div className={`w-full h-full p-12 flex flex-col items-center justify-center text-center ${theme.bgClass} relative overflow-hidden`}>
                   <BackgroundDecorations theme={theme} />
                   {theme.name === 'cyber' && (
                       <div className="absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-blue-900/20 via-slate-900/0 to-slate-900/0 pointer-events-none"></div>
                   )}
                   {theme.name === 'neo' && (
                       <>
                        <div className="absolute inset-0 bg-gradient-to-br from-slate-100 to-slate-200 -z-10"></div>
                        <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[600px] h-[600px] bg-white/30 rounded-full blur-3xl pointer-events-none"></div>
                       </>
                   )}
                   {theme.name === 'swiss' && (
                       <div className="absolute inset-0 border-[20px] border-black pointer-events-none"></div>
                   )}
                   
                   <div className="max-w-4xl z-10">
                       <h2 className={`font-bold mb-12 ${theme.fontTitle}`} style={{ color: theme.colors.primary, ...fs(4, fontScale), lineHeight: 1.1 }}>
                          {data.title}
                       </h2>
                       
                       <div className={`space-y-6 ${theme.fontBody}`} style={{ color: theme.colors.text }}>
                           {data.content.map((item, i) => (
                               <p key={i} className={i === 0 ? "font-semibold opacity-90" : "opacity-75"} style={fs(i === 0 ? 1.75 : 1.5, fontScale)}>
                                   {item}
                               </p>
                           ))}
                       </div>
                   </div>

                   {data.footer && <div className="absolute bottom-8 opacity-40" style={{ color: theme.colors.text, ...fs(0.875, fontScale) }}>{data.footer}</div>}
              </div>
          );
      };

      const ImageLeftSlide = ({ data, theme, fontScale = 1 }) => {
          return (
              <div className={`w-full h-full flex flex-row-reverse ${theme.bgClass} relative overflow-hidden`}>
                  <BackgroundDecorations theme={theme} />
                  {theme.name === 'neo' && <div className="absolute inset-0 bg-gradient-to-br from-slate-100 to-slate-200 -z-10" />}

                  <div className="w-1/2 p-12 flex flex-col relative z-10">
                      <div className="flex items-center gap-3 mb-8 pb-4 border-b" style={{ borderColor: `${theme.colors.primary}33` }}>
                           <h2 className={`font-bold ${theme.fontTitle}`} style={{ color: theme.colors.primary, ...fs(2.5, fontScale) }}>
                              {data.title}
                          </h2>
                      </div>
                      <div className="flex-1 overflow-y-auto">
                          <ul className={`flex flex-col gap-4 ${theme.fontBody}`}>
                              {data.content.map((item, idx) => (
                                  <li key={idx} className="flex items-start gap-3">
                                      <span className="mt-2 w-1.5 h-1.5 rounded-full flex-shrink-0" style={{ backgroundColor: theme.colors.secondary }} />
                                      <span className="leading-relaxed" style={{ color: theme.colors.text, ...fs(1.25, fontScale) }}>
                                          {item.includes(':') ? (
                                              <>
                                                  <span className="font-bold mr-1">{item.split(':')[0]}:</span>
                                                  <span className="opacity-90">{item.split(':').slice(1).join(':')}</span>
                                              </>
                                          ) : item}
                                      </span>
                                  </li>
                              ))}
                          </ul>
                      </div>
                       {data.footer && <div className="mt-8 opacity-40" style={{ color: theme.colors.text, ...fs(0.75, fontScale) }}>{data.footer}</div>}
                  </div>

                  <div className="w-1/2 p-8 flex items-center justify-center relative">
                       {theme.name === 'notebook' && (
                           <WashiTape color={theme.colors.accent} className="-top-0 left-1/3 -rotate-2" />
                       )}
                      <div 
                          className={`
                              w-full h-full flex flex-col items-center justify-center text-center
                              border-2 border-dashed rounded-xl relative overflow-hidden
                              ${getContainerStyle(theme)}
                              ${theme.name === 'notebook' ? 'bg-white shadow-lg -rotate-1' : ''}
                          `}
                          style={{ borderColor: theme.name === 'pop' || theme.name === 'swiss' || theme.name === 'bauhaus' ? 'black' : theme.colors.secondary }}
                      >
                          <div className="opacity-20 flex flex-col items-center gap-4">
                              <ImageIcon size={64} color={theme.colors.primary} />
                              <span className={`uppercase font-bold tracking-widest ${theme.fontBody}`} style={{ color: theme.colors.primary }}>
                                  Place Photo Here
                              </span>
                          </div>
                      </div>
                  </div>
              </div>
          );
      };

      const ImageRightSlide = ({ data, theme, fontScale = 1 }) => {
          return (
              <div className={`w-full h-full flex ${theme.bgClass} relative overflow-hidden`}>
                  <BackgroundDecorations theme={theme} />
                  {theme.name === 'neo' && <div className="absolute inset-0 bg-gradient-to-br from-slate-100 to-slate-200 -z-10" />}

                  <div className="w-1/2 p-12 flex flex-col relative z-10">
                      <div className="flex items-center gap-3 mb-8 pb-4 border-b" style={{ borderColor: `${theme.colors.primary}33` }}>
                           <h2 className={`font-bold ${theme.fontTitle}`} style={{ color: theme.colors.primary, ...fs(2.5, fontScale) }}>
                              {data.title}
                          </h2>
                      </div>
                      <div className="flex-1 overflow-y-auto">
                          <ul className={`flex flex-col gap-4 ${theme.fontBody}`}>
                              {data.content.map((item, idx) => (
                                  <li key={idx} className="flex items-start gap-3">
                                      <span className="mt-2 w-1.5 h-1.5 rounded-full flex-shrink-0" style={{ backgroundColor: theme.colors.secondary }} />
                                      <span className="leading-relaxed" style={{ color: theme.colors.text, ...fs(1.25, fontScale) }}>
                                          {item.includes(':') ? (
                                              <>
                                                  <span className="font-bold mr-1">{item.split(':')[0]}:</span>
                                                  <span className="opacity-90">{item.split(':').slice(1).join(':')}</span>
                                              </>
                                          ) : item}
                                      </span>
                                  </li>
                              ))}
                          </ul>
                      </div>
                       {data.footer && <div className="mt-8 opacity-40" style={{ color: theme.colors.text, ...fs(0.75, fontScale) }}>{data.footer}</div>}
                  </div>

                  <div className="w-1/2 p-8 flex items-center justify-center relative">
                       {theme.name === 'notebook' && (
                           <WashiTape color={theme.colors.accent} className="-top-0 right-1/3 rotate-2" />
                       )}
                      <div 
                          className={`
                              w-full h-full flex flex-col items-center justify-center text-center
                              border-2 border-dashed rounded-xl relative overflow-hidden
                              ${getContainerStyle(theme)}
                              ${theme.name === 'notebook' ? 'bg-white shadow-lg rotate-1' : ''}
                          `}
                          style={{ borderColor: theme.name === 'pop' || theme.name === 'swiss' || theme.name === 'bauhaus' ? 'black' : theme.colors.secondary }}
                      >
                          <div className="opacity-20 flex flex-col items-center gap-4">
                              <ImageIcon size={64} color={theme.colors.primary} />
                              <span className={`uppercase font-bold tracking-widest ${theme.fontBody}`} style={{ color: theme.colors.primary }}>
                                  Place Photo Here
                              </span>
                          </div>
                      </div>
                  </div>
              </div>
          );
      };

      const QuoteSlide = ({ data, theme, fontScale = 1 }) => {
          return (
              <div className={`w-full h-full p-16 flex flex-col items-center justify-center text-center relative ${theme.bgClass} overflow-hidden`}>
                  <BackgroundDecorations theme={theme} />
                  {theme.name === 'neo' && <div className="absolute inset-0 bg-gradient-to-br from-slate-100 to-slate-200 -z-10" />}

                  <div className="absolute inset-0 opacity-5 pointer-events-none">
                       <Quote size={400} className="absolute -top-20 -left-20" color={theme.colors.text} />
                  </div>
                  
                  <div className="relative z-10 max-w-5xl">
                      <Quote size={60} className="mb-8 mx-auto opacity-80" style={{ color: theme.colors.secondary }} />
                      
                      <div className={`leading-tight mb-10 font-bold ${theme.fontTitle}`} style={{ color: theme.colors.primary, ...fs(3, fontScale) }}>
                          "{data.content.join(' ')}"
                      </div>
                      
                      <div className="flex items-center justify-center gap-4">
                          <div className="h-px w-12" style={{ backgroundColor: theme.colors.secondary }}></div>
                          <div className={`font-bold ${theme.fontBody}`} style={{ color: theme.colors.text, ...fs(1.5, fontScale) }}>
                              {data.title}
                          </div>
                          <div className="h-px w-12" style={{ backgroundColor: theme.colors.secondary }}></div>
                      </div>
                      
                      {data.footer && (
                          <div className="mt-4 opacity-60 tracking-wider uppercase font-semibold" style={{ color: theme.colors.text, ...fs(0.875, fontScale) }}>{data.footer}</div>
                      )}
                  </div>
              </div>
          )
      }

      const TimelineSlide = ({ data, theme, fontScale = 1 }) => {
          return (
              <div className={`w-full h-full p-8 md:p-12 flex flex-col ${theme.bgClass} relative overflow-hidden`}>
                   <BackgroundDecorations theme={theme} />
                   {theme.name === 'neo' && <div className="absolute inset-0 bg-gradient-to-br from-slate-100 to-slate-200 -z-10" />}

                   <div className="flex items-center gap-4 mb-12 border-b pb-4 z-10" style={{ borderColor: `${theme.colors.primary}33` }}>
                      <div className="p-2 rounded-lg" style={{ backgroundColor: theme.name === 'swiss' ? 'black' : theme.colors.accent }}>
                          <GitCommit size={24} style={{ color: theme.name === 'swiss' ? 'white' : theme.colors.primary }} />
                      </div>
                      <h2 className={`font-bold ${theme.fontTitle}`} style={{ color: theme.colors.primary, ...fs(2.25, fontScale) }}>
                          {data.title}
                      </h2>
                  </div>
                  
                  <div className="flex-1 flex items-center justify-center relative px-4 z-10">
                      <div className="absolute w-[90%] h-1 bg-slate-300 rounded top-1/3 z-0"></div>
                      
                      <div className="w-full grid grid-flow-col auto-cols-fr gap-4 z-10">
                          {data.content.map((item, i) => (
                              <div key={i} className="flex flex-col relative group h-full">
                                  <div className="self-center mb-6 relative">
                                      <div className={`w-10 h-10 rounded-full border-4 flex items-center justify-center shadow-sm relative z-10 transition-transform group-hover:scale-110 
                                          ${theme.name === 'swiss' ? 'bg-black border-black text-white' : 'bg-white border-transparent'}
                                      `} style={{ borderColor: theme.name === 'swiss' ? 'black' : theme.colors.secondary }}>
                                          <span className={`font-bold text-sm ${theme.name === 'swiss' ? 'text-white' : 'text-slate-600'}`}>{i + 1}</span>
                                      </div>
                                  </div>
                                  
                                  <div className={`p-5 flex flex-col ${getContainerStyle(theme)}`}>
                                      {item.includes(':') ? (
                                          <>
                                              <h4 className={`font-bold mb-2 ${theme.fontTitle}`} style={{ color: theme.colors.primary, ...fs(1.125, fontScale) }}>
                                                  {item.split(':')[0]}
                                              </h4>
                                              <p className={`leading-snug opacity-80 ${theme.fontBody}`} style={{ color: theme.colors.text, ...fs(0.875, fontScale) }}>
                                                  {item.split(':').slice(1).join(':')}
                                              </p>
                                          </>
                                      ) : (
                                          <p className={`font-medium text-center ${theme.fontBody}`} style={{ color: theme.colors.text, ...fs(1, fontScale) }}>{item}</p>
                                      )}
                                  </div>
                              </div>
                          ))}
                      </div>
                  </div>
              </div>
          )
      }

      const GridSlide = ({ data, theme, fontScale = 1 }) => {
          const colClass = data.content.length > 4 ? 'grid-cols-3' : 'grid-cols-2';

          return (
              <div className={`w-full h-full p-8 md:p-12 flex flex-col ${theme.bgClass} relative overflow-hidden`}>
                   <BackgroundDecorations theme={theme} />
                   {theme.name === 'neo' && <div className="absolute inset-0 bg-gradient-to-br from-slate-100 to-slate-200 -z-10" />}

                   <div className="flex items-center gap-4 mb-8 border-b pb-4 z-10" style={{ borderColor: `${theme.colors.primary}33` }}>
                      <div className="p-2 rounded-lg" style={{ backgroundColor: theme.name === 'swiss' ? 'black' : theme.colors.accent }}>
                          <Grip size={24} style={{ color: theme.name === 'swiss' ? 'white' : theme.colors.primary }} />
                      </div>
                      <h2 className={`font-bold ${theme.fontTitle}`} style={{ color: theme.colors.primary, ...fs(2.25, fontScale) }}>
                          {data.title}
                      </h2>
                  </div>

                  <div className={`flex-1 grid ${colClass} gap-6 items-stretch justify-center content-center z-10`}>
                       {data.content.map((item, i) => (
                           <div 
                              key={i} 
                              className={`
                                  flex flex-col p-6 transition-all hover:shadow-md
                                  ${getContainerStyle(theme)}
                              `}
                              style={{ 
                                  backgroundColor: (i % 2 !== 0 && theme.name !== 'professional' && theme.name !== 'cyber' && theme.name !== 'onyx' && theme.name !== 'neo' && theme.name !== 'swiss' && theme.name !== 'sunset' && theme.name !== 'ocean' && theme.name !== 'forest' && theme.name !== 'electric') ? theme.colors.accent + '20' : undefined 
                              }}
                           >
                               {item.includes('|') || item.includes(':') ? (
                                   <>
                                      <h3 className={`font-bold mb-2 ${theme.fontTitle}`} style={{ color: theme.colors.primary, ...fs(1.25, fontScale) }}>
                                          {item.split(/[:|]/)[0]}
                                      </h3>
                                      <p className={`leading-relaxed opacity-80 ${theme.fontBody}`} style={{ color: theme.colors.text, ...fs(1, fontScale) }}>
                                          {item.split(/[:|]/).slice(1).join(' ')}
                                      </p>
                                   </>
                               ) : (
                                   <p className={`font-bold text-center m-auto ${theme.fontBody}`} style={{ color: theme.colors.text, ...fs(1.5, fontScale) }}>{item}</p>
                               )}
                           </div>
                       ))}
                  </div>
                   {data.footer && <div className="absolute bottom-4 right-8 opacity-40" style={{ color: theme.colors.text, ...fs(0.75, fontScale) }}>{data.footer}</div>}
              </div>
          )
      }

      const SlideRenderer = (props) => {
        switch (props.data.type) {
          case 'title': return <TitleSlide {...props} />;
          case 'list': return <ListSlide {...props} />;
          case 'split': return <SplitSlide {...props} />;
          case 'quote': return <QuoteSlide {...props} />;
          case 'timeline': return <TimelineSlide {...props} />;
          case 'grid': return <GridSlide {...props} />;
          case 'image-right': return <ImageRightSlide {...props} />;
          case 'image-left': return <ImageLeftSlide {...props} />;
          case 'comparison': return <ComparisonSlide {...props} />;
          case 'centered': return <CenteredSlide {...props} />;
          default: return <ListSlide {...props} />;
        }
      };

      // ==========================================
      // APP
      // ==========================================

      const ScaledPreview = ({ data, theme, fontScale, slideIndex, totalSlides, onPrev, onNext, onFullscreen }) => {
        const containerRef = useRef(null);
        const [scale, setScale] = useState(1);
        const [containerWidth, setContainerWidth] = useState(0);

        // UPDATED: better scaling logic with padding and device-specific adjustments
        useLayoutEffect(() => {
          const handleResize = () => {
            if (containerRef.current) {
              const parent = containerRef.current;
              const availableWidth = parent.clientWidth;
              const availableHeight = parent.clientHeight;
              
              setContainerWidth(availableWidth);
              
              const slideWidth = 1280;
              const slideHeight = 720;
              
              // Dynamic padding based on screen size
              const isMobile = window.innerWidth < 768;
              const padding = isMobile ? 16 : 40; // more padding on mobile
              
              const scaleW = (availableWidth - padding) / slideWidth;
              const scaleH = (availableHeight - padding) / slideHeight;
              
              // Use smaller scale to ensure full visibility
              const newScale = Math.min(scaleW, scaleH, 1.2); // cap at 1.2 for extremely large screens
              
              setScale(newScale);
            }
          };
          
          handleResize();
          window.addEventListener('resize', handleResize);
          return () => window.removeEventListener('resize', handleResize);
        }, []);

        // UPDATED: better touch handling for mobile
        const handleTouchStart = (e) => {
          // Prevent accidental page scroll when swiping on slide
          e.stopPropagation();
        };

        return (
          <div className="flex-1 flex flex-col h-full bg-[#111827] relative animate-fade-in">
             <div className="h-14 flex items-center justify-between px-4 border-b border-slate-800 bg-[#111827] z-20">
                  <div className="flex items-center gap-2">
                     <span className="text-slate-400 text-xs md:text-sm font-medium">Slide Preview</span>
                  </div>

                  <div className="flex items-center gap-2 bg-slate-800 p-1 rounded-lg border border-slate-700">
                      <button 
                        onClick={onPrev} 
                        className="p-1.5 hover:bg-slate-700 rounded text-slate-300 transition-colors hover:scale-110 touch-manipulation"
                        aria-label="Previous slide"
                      >
                          <ChevronLeft size={16} />
                      </button>
                      <span className="text-[10px] md:text-xs font-mono w-12 text-center text-slate-400">
                          {slideIndex + 1} / {totalSlides}
                      </span>
                      <button 
                        onClick={onNext} 
                        className="p-1.5 hover:bg-slate-700 rounded text-slate-300 transition-colors hover:scale-110 touch-manipulation"
                        aria-label="Next slide"
                      >
                          <ChevronRight size={16} />
                      </button>
                  </div>

                  <button 
                      onClick={onFullscreen}
                      className="flex items-center gap-2 px-3 py-1.5 text-xs font-medium text-slate-300 hover:text-white hover:bg-slate-800 rounded-md transition-all hover:scale-105 touch-manipulation"
                      aria-label="Enter fullscreen"
                  >
                      <Play size={14} /> <span className="hidden sm:inline">Present</span>
                  </button>
              </div>

              <div 
                ref={containerRef} 
                className="flex-1 w-full flex items-center justify-center overflow-hidden bg-[radial-gradient(#1f2937_1px,transparent_1px)] [background-size:20px_20px] relative touch-pan-y"
                onTouchStart={handleTouchStart}
              >
                {data ? (
                  <div 
                    style={{
                      width: '1280px',
                      height: '720px',
                      transform: `scale(${scale})`,
                      marginLeft: 'auto',
                      marginRight: 'auto',
                      transformOrigin: 'center center',
                      boxShadow: '0 25px 50px -12px rgba(0, 0, 0, 0.5)'
                    }}
                    className="bg-white pointer-events-none select-none animate-float-pop transition-transform duration-200 ease-out"
                  >
                     <SlideRenderer data={data} theme={theme} fontScale={fontScale} />
                  </div>
                ) : (
                  <div className="text-slate-500">No data</div>
                )}
              </div>
          </div>
        );
      };

      const App = () => {
        const [csvInput, setCsvInput] = useState(DEFAULT_CSV);
        const [slides, setSlides] = useState([]);
        const [currentSlideIndex, setCurrentSlideIndex] = useState(0);
        const [themeName, setThemeName] = useState('notebook');
        const [fontScale, setFontScale] = useState(1.0);
        const [activeSidebarTab, setActiveSidebarTab] = useState('content');
        const [mobileView, setMobileView] = useState('editor');
        // floating menu state
        const [floatingMenuOpen, setFloatingMenuOpen] = useState(false);

        const previewRef = useRef(null);
        const exportRef = useRef(null);
        const [isDownloading, setIsDownloading] = useState(false);
        const menuButtonRef = useRef(null);

        useEffect(() => {
          try {
            const parsed = parseCSV(csvInput);
            setSlides(parsed);
            if (currentSlideIndex >= parsed.length) {
              setCurrentSlideIndex(0);
            }
          } catch (e) {
            console.error("Failed to parse CSV", e);
          }
        }, [csvInput]);

        const handleCopyPrompt = () => {
          navigator.clipboard.writeText(CHATGPT_PROMPT);
          alert("Prompt copied to clipboard!");
        };

        const handleNext = () => {
          if (currentSlideIndex < slides.length - 1) setCurrentSlideIndex(p => p + 1);
        };

        const handlePrev = () => {
          if (currentSlideIndex > 0) setCurrentSlideIndex(p => p - 1);
        };

        const toggleFullscreen = () => {
          if (!document.fullscreenElement) {
              previewRef.current?.requestFullscreen();
          } else {
              document.exitFullscreen();
          }
        };

        const handleDownloadPPTX = async () => {
          if (!exportRef.current || slides.length === 0) return;
          setIsDownloading(true);
          try {
              const slideElements = Array.from(exportRef.current.children);
              const images = [];
              await document.fonts.ready;

              for (const el of slideElements) {
                   const dataUrl = await toPng(el, { 
                      quality: 0.95, 
                      pixelRatio: 2, 
                      cacheBust: true,
                   });
                   images.push(dataUrl);
              }
              await generatePPTX(images, themeName);
          } catch (error) {
              console.error("Download failed", error);
              alert("Failed to generate PPTX.");
          } finally {
              setIsDownloading(false);
          }
        };

        useEffect(() => {
          const handleKeyDown = (e) => {
              if (e.key === 'ArrowRight') handleNext();
              if (e.key === 'ArrowLeft') handlePrev();
          };
          window.addEventListener('keydown', handleKeyDown);
          return () => window.removeEventListener('keydown', handleKeyDown);
        }, [slides.length, currentSlideIndex]);

        // close floating menu when clicking outside
        useEffect(() => {
          const handleClickOutside = (e) => {
            if (menuButtonRef.current && !menuButtonRef.current.contains(e.target)) {
              setFloatingMenuOpen(false);
            }
          };
          document.addEventListener('mousedown', handleClickOutside);
          return () => document.removeEventListener('mousedown', handleClickOutside);
        }, []);

        return (
          <div className="flex h-screen w-full bg-[#111827] text-slate-100 font-sans-pro flex-col md:flex-row overflow-hidden">
            
            {/* floating menu button + popup */}
            <div className="fixed bottom-24 right-4 md:bottom-8 md:right-8 z-50" ref={menuButtonRef}>
              {/* popup menu */}
              {floatingMenuOpen && (
                <div className="absolute bottom-16 right-0 bg-[#1f2937] border border-slate-700 rounded-xl shadow-2xl p-2 w-48 animate-float-pop">
                  <a href="https://arcaneplotterexam.netlify.app/" target="_blank" rel="noopener noreferrer" 
                     className="flex items-center gap-3 px-4 py-3 hover:bg-slate-800 rounded-lg transition-all text-slate-200 group hover:scale-105">
                    <ExternalLink size={16} className="text-blue-400 group-hover:rotate-12 transition-transform" /> 
                    <span className="text-sm font-medium">Exam</span>
                  </a>
                  <a href="https://arcanenotes.netlify.app/" target="_blank" rel="noopener noreferrer"
                     className="flex items-center gap-3 px-4 py-3 hover:bg-slate-800 rounded-lg transition-all text-slate-200 group hover:scale-105">
                    <ExternalLink size={16} className="text-green-400 group-hover:rotate-12 transition-transform" /> 
                    <span className="text-sm font-medium">Notes</span>
                  </a>
                  <a href="https://arcanestats.netlify.app/" target="_blank" rel="noopener noreferrer"
                     className="flex items-center gap-3 px-4 py-3 hover:bg-slate-800 rounded-lg transition-all text-slate-200 group hover:scale-105">
                    <ExternalLink size={16} className="text-purple-400 group-hover:rotate-12 transition-transform" /> 
                    <span className="text-sm font-medium">Stats</span>
                  </a>
                </div>
              )}
              {/* floating button */}
              <button 
                onClick={() => setFloatingMenuOpen(!floatingMenuOpen)}
                className="w-14 h-14 rounded-full bg-gradient-to-r from-blue-600 to-indigo-600 shadow-xl flex items-center justify-center text-white hover:scale-110 transition-transform border-2 border-white/20 animate-pulse-glow"
              >
                {floatingMenuOpen ? <X size={24} className="animate-spin" /> : <Menu size={24} />}
              </button>
            </div>

            <div style={{ position: 'fixed', top: '0', left: '100vw', pointerEvents: 'none', zIndex: -1 }}>
              <div ref={exportRef}>
                  {slides.map((slide, idx) => (
                      <div 
                          key={`export-${idx}`}
                          style={{ width: '1280px', height: '720px' }}
                          className="relative bg-white overflow-hidden"
                      >
                          <div className="w-full h-full">
                               <SlideRenderer data={slide} theme={THEMES[themeName]} fontScale={fontScale} />
                          </div>
                      </div>
                  ))}
              </div>
            </div>

            <div className={`
              flex-col border-r border-slate-800 bg-[#1f2937]
              w-full md:w-[400px] h-[calc(100vh-60px)] md:h-full
              ${mobileView === 'editor' ? 'flex' : 'hidden md:flex'}
              animate-slide-in-left
            `}>
              
              <div className="p-4 md:p-5 border-b border-slate-700 flex items-center gap-3 bg-[#1f2937]">
                  <div className="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center shadow-lg shadow-blue-900/50 animate-pulse">
                      <Layout className="text-white" size={18} />
                  </div>
                  <div>
                      <h1 className="font-bold text-lg tracking-tight text-white leading-none">ArcaneSlides</h1>
                      <p className="text-[10px] text-slate-400 font-medium">veni vidi vici</p>
                  </div>
              </div>

              <div className="flex p-2 gap-2 border-b border-slate-700 bg-[#1f2937]">
                  <button 
                      onClick={() => setActiveSidebarTab('content')}
                      className={`flex-1 py-2 px-3 rounded-md text-xs md:text-sm font-medium flex items-center justify-center gap-2 transition-all hover-lift
                      ${activeSidebarTab === 'content' ? 'bg-slate-700 text-white shadow-sm' : 'text-slate-400 hover:text-slate-200 hover:bg-slate-800'}`}
                  >
                      <Type size={14} /> Content
                  </button>
                  <button 
                      onClick={() => setActiveSidebarTab('design')}
                      className={`flex-1 py-2 px-3 rounded-md text-xs md:text-sm font-medium flex items-center justify-center gap-2 transition-all hover-lift
                      ${activeSidebarTab === 'design' ? 'bg-slate-700 text-white shadow-sm' : 'text-slate-400 hover:text-slate-200 hover:bg-slate-800'}`}
                  >
                      <Palette size={14} /> Design
                  </button>
              </div>

              <div className="flex-1 overflow-y-auto custom-scrollbar p-4 md:p-6 pb-24 md:pb-6">
                  {activeSidebarTab === 'content' ? (
                      <div className="flex flex-col h-full gap-4 md:gap-6">
                           <div className="bg-slate-800/50 p-4 rounded-xl border border-slate-700 hover-lift">
                              <div className="flex items-center justify-between mb-2">
                                  <span className="text-[10px] font-bold uppercase tracking-wider text-slate-500">AI Assistant</span>
                                  <Wand2 size={12} className="text-purple-400 animate-spin-slow" />
                              </div>
                              <p className="text-xs text-slate-400 mb-3 leading-relaxed">
                                  Generate your slide content using ChatGPT, then paste the CSV below.
                              </p>
                              <button 
                                  onClick={handleCopyPrompt}
                                  className="w-full flex items-center justify-center gap-2 bg-slate-700 hover:bg-slate-600 text-white py-2 px-3 rounded-lg text-xs font-medium transition-all border border-slate-600 hover:scale-105"
                              >
                                  <Copy size={12} /> Copy Prompt
                              </button>
                          </div>

                          <div className="flex-1 flex flex-col min-h-[300px]">
                              <label className="text-[10px] font-bold uppercase tracking-wider text-slate-500 mb-2">CSV Data Source</label>
                              <textarea
                                  className="flex-1 w-full p-3 text-xs md:text-sm font-mono leading-relaxed bg-[#0f172a] border border-slate-700 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none resize-none text-slate-300 shadow-inner transition-all hover:border-slate-600"
                                  value={csvInput}
                                  onChange={(e) => setCsvInput(e.target.value)}
                                  placeholder="type, title, content..."
                                  spellCheck={false}
                              />
                               <div className="mt-2 text-[10px] text-slate-500 flex justify-between">
                                  <span>{slides.length} slides detected</span>
                                  <span>Markdown supported</span>
                               </div>
                          </div>
                      </div>
                  ) : (
                      <div className="flex flex-col gap-8">
                          <div>
                              <label className="text-[10px] font-bold uppercase tracking-wider text-slate-500 mb-3 block">Visual Theme</label>
                              <div className="grid grid-cols-1 gap-3">
                              {Object.keys(THEMES).map((t) => (
                                  <button
                                  key={t}
                                  onClick={() => setThemeName(t)}
                                  className={`flex items-center gap-4 p-3 rounded-xl border-2 transition-all text-left group hover-lift
                                      ${themeName === t 
                                      ? 'border-blue-500 bg-blue-500/10' 
                                      : 'border-slate-700 hover:border-slate-600 bg-slate-800/50'
                                      }`}
                                  >
                                      <div className={`w-10 h-10 md:w-12 md:h-12 rounded-lg shadow-sm flex-shrink-0 border transition-transform group-hover:scale-110 
                                      ${t === 'notebook' ? 'bg-[#fdfbf7] border-slate-200' : 
                                        t === 'grid' ? 'bg-white border-purple-200' : 
                                        t === 'professional' ? 'bg-slate-100 border-slate-300' :
                                        t === 'cyber' ? 'bg-slate-900 border-slate-700' :
                                        t === 'pop' ? 'bg-yellow-100 border-red-200' :
                                        t === 'swiss' ? 'bg-white border-black' :
                                        t === 'neo' ? 'bg-slate-100 border-slate-200' :
                                        t === 'onyx' ? 'bg-zinc-900 border-zinc-700' :
                                        t === 'sunset' ? 'bg-gradient-to-r from-orange-400 to-pink-500 border-orange-200' :
                                        t === 'ocean' ? 'bg-gradient-to-r from-cyan-500 to-blue-600 border-blue-200' :
                                        t === 'forest' ? 'bg-emerald-900 border-emerald-700' :
                                        t === 'bauhaus' ? 'bg-[#f4f4f0] border-red-500' :
                                        t === 'electric' ? 'bg-[#4c1d95] border-yellow-400' :
                                        t === 'candy' ? 'bg-pink-100 border-pink-300' :
                                        'bg-stone-100 border-stone-300'
                                      }`}></div>
                                      <div>
                                          <div className={`font-semibold capitalize text-sm md:text-base ${themeName === t ? 'text-blue-400' : 'text-slate-200'}`}>{t}</div>
                                          <div className="text-[10px] md:text-xs text-slate-400 mt-0.5">
                                              {t === 'notebook' && 'Handwritten & Organic'}
                                              {t === 'grid' && 'Structured & Clean'}
                                              {t === 'professional' && 'Corporate & Sleek'}
                                              {t === 'cyber' && 'Dark & Neon'}
                                              {t === 'pop' && 'Bold & Playful'}
                                              {t === 'elegant' && 'Minimalist Serif'}
                                              {t === 'swiss' && 'Bold International Style'}
                                              {t === 'neo' && 'Modern Glassmorphism'}
                                              {t === 'onyx' && 'Premium Dark Mode'}
                                              {t === 'sunset' && 'Warm Gradient'}
                                              {t === 'ocean' && 'Cool Gradient'}
                                              {t === 'forest' && 'Deep Nature'}
                                              {t === 'bauhaus' && 'Geometric Art'}
                                              {t === 'electric' && 'High Voltage'}
                                              {t === 'candy' && 'Soft Pastels'}
                                          </div>
                                      </div>
                                  </button>
                              ))}
                              </div>
                          </div>

                          <div>
                              <div className="flex items-center justify-between mb-3">
                                  <label className="text-[10px] font-bold uppercase tracking-wider text-slate-500">Text Scaling</label>
                                  <span className="text-xs text-slate-400 bg-slate-800 px-2 py-0.5 rounded font-mono">
                                      {Math.round(fontScale * 100)}%
                                  </span>
                              </div>
                              <div className="bg-slate-800/50 p-4 rounded-xl border border-slate-700 hover-lift">
                                   <div className="flex items-center gap-3">
                                       <TypeIcon size={14} className="text-slate-500" />
                                       <input 
                                          type="range" 
                                          min="0.75" 
                                          max="1.75" 
                                          step="0.05" 
                                          value={fontScale} 
                                          onChange={(e) => setFontScale(parseFloat(e.target.value))}
                                          className="flex-1 h-2 bg-slate-600 rounded-lg appearance-none cursor-pointer accent-blue-500 transition-all hover:scale-y-125"
                                       />
                                       <TypeIcon size={20} className="text-slate-300" />
                                   </div>
                                   <p className="text-[10px] text-slate-500 mt-2 text-center">
                                      Adjust if text overlaps or is too small.
                                   </p>
                              </div>
                          </div>
                      </div>
                  )}
              </div>

              <div className="hidden md:flex p-5 border-t border-slate-800 bg-[#1f2937] flex-col gap-3">
                  <button 
                      onClick={handleDownloadPPTX}
                      disabled={isDownloading}
                      className="w-full flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-500 disabled:opacity-50 disabled:cursor-not-allowed text-white py-3 px-4 rounded-xl text-sm font-bold transition-all shadow-lg shadow-blue-900/20 active:scale-95 hover:scale-105 hover-lift"
                  >
                      {isDownloading ? (
                          <span className="flex items-center gap-2 animate-pulse">
                              <Wand2 className="animate-spin" size={16} /> Rendering...
                          </span>
                      ) : (
                          <>
                              <FileDown size={18} /> Export as PPTX
                          </>
                      )}
                  </button>
              </div>
            </div>

            <div className={`
              flex-1 flex-col relative bg-[#111827] h-[calc(100vh-60px)] md:h-full
              ${mobileView === 'preview' ? 'flex' : 'hidden md:flex'}
              animate-fade-in
            `}>
              
              <div ref={previewRef} className="flex-1 flex flex-col bg-[#111827] w-full h-full overflow-hidden">
                   <ScaledPreview 
                      data={slides[currentSlideIndex]} 
                      theme={THEMES[themeName]}
                      fontScale={fontScale}
                      slideIndex={currentSlideIndex}
                      totalSlides={slides.length}
                      onPrev={handlePrev}
                      onNext={handleNext}
                      onFullscreen={toggleFullscreen}
                   />
              </div>

              <div className="h-24 md:h-40 bg-[#1f2937] border-t border-slate-800 flex flex-col flex-shrink-0 z-20">
                  <div className="px-4 md:px-6 py-2 text-[10px] md:text-xs font-semibold text-slate-500 uppercase tracking-wider flex justify-between items-center">
                      <span>Slide Deck</span>
                      <span className="md:hidden text-slate-600">{currentSlideIndex + 1}/{slides.length}</span>
                  </div>
                  <div className="flex-1 overflow-x-auto flex items-center gap-3 md:gap-4 px-4 md:px-6 pb-2 md:pb-4 custom-scrollbar">
                      {slides.map((slide, idx) => (
                          <button 
                          key={idx}
                          onClick={() => setCurrentSlideIndex(idx)}
                          className={`flex-shrink-0 h-16 md:h-24 aspect-video bg-white rounded overflow-hidden relative shadow-md transition-all group
                              ${idx === currentSlideIndex ? 'ring-2 ring-blue-500 scale-105 z-10' : 'opacity-60 hover:opacity-100 hover:scale-105'}
                          `}
                          >
                              <div className="transform scale-[0.2] origin-top-left w-[500%] h-[500%] pointer-events-none select-none">
                                  <SlideRenderer data={slide} theme={THEMES[themeName]} fontScale={fontScale} />
                              </div>
                              <div className="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors" />
                          </button>
                      ))}
                  </div>
              </div>
            </div>

            <div className="md:hidden h-[60px] bg-[#1f2937] border-t border-slate-800 flex items-center justify-around px-2 z-40 fixed bottom-0 w-full pb-safe">
                  <button 
                      onClick={() => setMobileView('editor')}
                      className={`flex flex-col items-center justify-center p-2 rounded-lg gap-1 transition-all w-20 hover:scale-110
                      ${mobileView === 'editor' ? 'text-blue-400' : 'text-slate-500 hover:text-slate-300'}`}
                  >
                      <Edit3 size={20} />
                      <span className="text-[10px] font-medium">Editor</span>
                  </button>

                  <button 
                       onClick={handleDownloadPPTX}
                       disabled={isDownloading}
                       className="flex flex-col items-center justify-center w-12 h-12 -mt-6 bg-blue-600 rounded-full shadow-lg shadow-blue-900/50 text-white hover:bg-blue-500 transition-all active:scale-95 border-4 border-[#1f2937] hover:scale-110"
                  >
                      {isDownloading ? <Wand2 className="animate-spin" size={20} /> : <FileDown size={20} />}
                  </button>

                  <button 
                      onClick={() => setMobileView('preview')}
                      className={`flex flex-col items-center justify-center p-2 rounded-lg gap-1 transition-all w-20 hover:scale-110
                      ${mobileView === 'preview' ? 'text-blue-400' : 'text-slate-500 hover:text-slate-300'}`}
                  >
                      <MonitorPlay size={20} />
                      <span className="text-[10px] font-medium">Preview</span>
                  </button>
            </div>

          </div>
        );
      };

      const root = createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>